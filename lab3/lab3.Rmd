# Лабораторная работа 3
## Задачи для лабораторной: 
* работа с текстом;
* использование регулярных выражений для извлечения данных;
* переписывание существующего кода;
* ассиметричные распределения.

## Требования к оформлению
* Оформить решение в R Markdown. 
* Сохранить файл в свой репозиторий.
* Выгрузить R Markdown в HTML, назвать своим именем и отправить по почте (если хочется сдать раньше или нужна помощь).

## Исходные данные
Файл _forbes.htm_ содержит список богатейших американцев по версии журнала Форбс.
На его примере потренируемся в разборе html страниц.

### Задание 1
1. Используйте команду ``readLines`` для загрузки файла в текстовый вектор _html_.
   1. Сколько строк в файле?
   2. Сколько символов в файле?
   
```{r}
text <- readLines("D:/Учёба/Многомерные данные/MD-DA-2018/lab3/forbes.htm")
strings.count <- length(text)   #1991
symbols.count <- sum(nchar(text))   #80380
```
   
2. Откройте файл в текстовом редакторе. Найдите строки, содержащие данные о Билле Гейтсе и Ларри Эллисоне и запомните размер их дохода.

```
Bill Gates: $72 B
Larry Ellison: $41 B
```

3. Напишите шаблон регулярного выражения и используйте функцию ``grep``, чтобы извлечь размер дохода из данных в векторе _html_.
Удостоверьтесь, что полученный вектор номеров строк содержит содержит ровно 100 записей и ссылается на номера строк в котрых действительно есть
информация о доходе, а не просто первый попавшийся текст.

```{r}
incomes.strings <- grep("[$]\\d+.*B", text)
length(incomes.strings) == 100    #TRUE

```

4. Напишите код, использовав регулярное выражение из п. 3, и функции ``regexpr`` и ``regmatches``, чтобы извлечь все данные о доходе.
Проверьте следующее:
   1. Должно быть ровно сто значений.
   2. Самый большой доход должен быть доход Билла Гейтса
   3. Такой доход должен быть в списке один раз.
   4. В всписке должна быть цифра, которую мы запомнили для Ларри Эллисона.
   5. Должно быть как минимум два значения, встречающихся несколько раз.
   
```{r}
matched <- regexpr("[$]\\d+.*B", text = text)
incomes <- regmatches(text, matched)
length(incomes) == 100
"$72 B" %in% incomes
length(incomes[incomes == "$72 B"]) == 1
"$41 B" %in% incomes
dublicates.count <- length(incomes) - length(unique(incomes))

```
   
### Задание 2
5. В данных доход представлен в формате **"$42 B"**, что означает **42 × 10^9**.
Преобразуйте этот формат в числовой и сохраните в вектор _worths_. Удостоверьтесь в следующем:
   1. _worths_ является вектором и в нём сто занчений типа _double_.
   2. Все элементы вектора _worths_ больше 1 миллиарда.
   3. Самое большое число это доход Билла Гейтса.
   
```{r}
number.pattern <- "\\d+,?\\d?";
worths <- as.double(gsub(",", ".", regmatches(incomes, regexpr(number.pattern, incomes)))) * 10^9
typeof(worths) == "double"
length(worths) == 100
all(worths > 10^9)
max(worths) == 72*10^9
```
   
6. Используйте вектор _worths_ , чтобы выяснить следующее:
   1. Какова медиана ста этих записей?
   2. Средний доход?
   3. Как много людей из этого списка имеют доход больше 5млрд., 10, 25? 
   1. Какой их общий доход?
   2. Какую долю от общего дохода, составляет пятёрка самых богатых.
   3. Какую долю от общего дохода, составляют 20 самых богатых.
   4. В данных [федерального резерва США](https://www.federalreserve.gov/releases/z1/current/html/introductory_text.htm) найдите
   показатель дохода всех домохозяйств (Household net worth) в соответвующем году, какую долю
   общего дохода составляют 100 богатейших людей.
   
```{r}
worths.median <- median(worths)     #8.3*10^9
worths.mean <- mean(worths)     #1.293*10^10
over.5B <- length(worths[worths > 5*10^9])    #89
over.10B <- length(worths[worths > 10^10])    #39
over.25B <- length(worths[worths > 2.5*10^10])    #12
sum.worth <- sum(worths)
bo5.rate <- sum(worths[1:5]) / sum.worth    #0.1883217
bo20.rate <- sum(worths[1:20]) / sum.worth    #0.4921114
usa <- readLines("https://www.federalreserve.gov/releases/z1/current/html/introductory_text.htm")
household.string <- usa[grep("2013", usa)]
net.worth <- as.double(gsub(",", ".", regmatches(household.string, regexpr("\\d+,\\d*", household.string)))) * 10^12
rich.rate <- sum(worths) / net.worth    #0.0165
```